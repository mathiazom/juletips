---
import type {InferGetStaticParamsType} from "astro";
import {PortableText} from "astro-portabletext";
import Layout from "../../layouts/Layout.astro";
import {urlFor} from "../../utils/image";
import {getWish, getWishes} from "../../utils/sanity";

export async function getStaticPaths() {
    const posts = await getWishes();
    return posts.map((wish) => ({
        params: {slug: wish.slug.current},
    }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const {slug} = Astro.params as Params;

const wish = await getWish(slug);
---

<Layout title={wish.title!}>
    <section>
        {
            wish.mainImage ? (
                    <img
                            class="post__cover"
                            src={urlFor(wish.mainImage).url()}
                            alt="Cover image"
                    />
            ) : (
                    <div class="post__cover--none"/>
            )
        }
        <div class="post__container">
            <h1 class="post__title">{wish.title}</h1>
            <p class="post__excerpt">{wish.excerpt}</p>
            <div class="post__content">
                <PortableText value={wish.body}/>
            </div>
        </div>
    </section>
</Layout>
